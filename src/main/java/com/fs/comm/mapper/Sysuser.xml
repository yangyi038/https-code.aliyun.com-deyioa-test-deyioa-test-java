<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fs.comm.mapper.SysuserMapper">
	<resultMap type="com.fs.comm.model.Sysuser" id="sysuser">
		<result property="id" column="ID" />
		<result property="loginname" column="LOGINNAME" />
		<result property="loginpwd" column="LOGINPWD" />
		<result property="privilege" column="PRIVILEGE" />
		<result property="depid" column="DEPID" />
		<result property="realname" column="REALNAME" />
		<result property="logintimes" column="LOGINTIMES" />
		<result property="lastlogin" column="LASTLOGIN" />
		<result property="isclose" column="ISCLOSE" />

		<result property="admintype" column="admintype" />
		<result property="companyid" column="companyid" />
		<result property="companyadminid" column="companyadminid" />
		<result property="operatorid" column="operatorid" />
		<result property="dealerid" column="dealerid" />

		<association property="department" javaType="com.fs.comm.model.Department">
			<result property="depname" column="DEPNAME" />
		</association>
		<association property="sysrole" javaType="com.fs.comm.model.Role">
			<result property="rolename" column="ROLENAME" />
		</association>

	</resultMap>

	<!--获取登录用户 -->
	<select id="selectSysuser" resultMap="sysuser">
		select * from sysuser where 1=1
		<if test="loginname != null and loginname != ''">
			and LOGINNAME=#{loginname}
		</if>
		<if test="loginpwd!= null and loginpwd!= ''">
			and LOGINPWD=#{loginpwd}
		</if>
		<if test="companyid != null and companyid != ''">
			and companyid=#{companyid}
		</if>
		<if test="companyadminid != null and companyadminid != ''">
			and companyadminid=#{companyadminid}
		</if>
		<if test="operatorid != null and operatorid != ''">
			and operatorid=#{operatorid}
		</if>
		<if test="dealerid != null and dealerid != ''">
			and dealerid=#{dealerid}
		</if>
	</select>


	<select id="loadSysuser" resultMap="sysuser">
		select
		s.*,d.depname,r.rolename
		from
		sysuser s
		left join sysrole r on
		s.privilege=r.id
		left join department d on
		s.depid=d.id where
		s.id=#{id}
	</select>

	<select id="browseSysuser" resultMap="sysuser">
		select s.*,
		d.depname,
		r.rolename 
		from sysuser s
		left join sysrole r on
		s.privilege=r.id
		left join department d on s.depid=d.id
		where
		1=1
		<if test="loginname!= null and loginname!= ''">
			and s.loginname =#{loginname}
		</if>
		<!-- 修改系统用户，验证用户名是否已经存在 -->
		<if test="notid!= null and notid!= ''">
			and s.id !=#{notid}
		</if>
	</select>

	<!-- 添加登录用户 -->
	<insert id="saveSysuser" parameterType="com.fs.comm.model.Sysuser">
		insert into
		sysuser(
		loginname,loginpwd,privilege,depid,lastlogin,logintimes,isclose,
		admintype,companyid,companyadminid,operatorid,dealerid
		)
		values(
		#{loginname,jdbcType=VARCHAR},#{loginpwd,jdbcType=VARCHAR},#{privilege,jdbcType=VARCHAR},
		#{depid,jdbcType=INTEGER},#{lastlogin,jdbcType=DATE},
		#{logintimes,jdbcType=INTEGER},#{isclose,jdbcType=INTEGER},
		#{admintype,jdbcType=INTEGER},#{companyid,jdbcType=BIGINT}
		,#{companyadminid,jdbcType=BIGINT}
		,#{operatorid,jdbcType=BIGINT}
		,#{dealerid,jdbcType=BIGINT}
		)
	</insert>

	<!-- 修改登录用户信息 -->
	<update id="updateSysuser" parameterType="com.fs.comm.model.Sysuser">
		update sysuser
		<set>
			<if test="loginname != null and loginname != ''">
				loginname=#{loginname},
			</if>
			<if test="privilege != null and privilege != ''">
				privilege=#{privilege},
			</if>
			<if test="depid != null and depid != ''">
				depid=#{depid},
			</if>
			<if test="logintimes != null and logintimes != ''">
				logintimes=#{logintimes},
			</if>
			<if test="isclose != null and isclose != ''">
				isclose=#{isclose},
			</if>
			<if test="loginpwd != null and loginpwd != ''">
				loginpwd=#{loginpwd},
			</if>
		</set>
		where id=#{id}
	</update>

	<!-- 主键删除 -->
	<delete id="delById">
		delete from sysuser where id=#{id}
	</delete>

	<!-- 删除 -->
	<delete id="delSysUser" parameterType="java.util.Map">
		delete from sysuser where 1=1
		<if test="companyid !=null">
			and companyid = #{companyid}
		</if>
		<if test="companyadminid !=null">
			and companyadminid = #{companyadminid}
		</if>
		<if test="operatorid !=null">
			and operatorid = #{operatorid}
		</if>
		<if test="dealerid !=null">
			and dealerid = #{dealerid}
		</if>
		<if test="admintype !=null ">
			and admintype = #{admintype}
		</if>
	</delete>

	<insert id="saveSysloginlog" parameterType="com.fs.comm.model.Sysloginlog">
		insert into
		sysloginlog(sid,logintime,loginip,loginname,comments)
		values(#{sid,jdbcType=INTEGER},#{logintime,jdbcType=DATE},#{loginip,jdbcType=VARCHAR},#{loginname,jdbcType=VARCHAR},#{comments,jdbcType=VARCHAR})
	</insert>
	
	<update id="updatePsw">
		update sysuser set loginpwd=#{password}
		where id=#{id}
	</update>
</mapper>